{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CampusLink ‚Äì Student Profile</title>
  <link rel="stylesheet" href="{% static 'Myapp/profile.css' %}?v=1.3">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  
</head>
<body>
  <header class="header">
    <div class="logo">
      <i class="fa-solid fa-graduation-cap"></i>
      <span>CampusLink</span>
    </div>
    <nav>
      <a href="#" class="{% if request.resolver_match.url_name == 'student_dashboard' %}active{% endif %}">Home</a>
      <a href="/my-applications/" class="{% if request.resolver_match.url_name == 'my_applications' %}active{% endif %}">My Applications</a>
      <a href="{% url 'profile' %}" class="{% if request.resolver_match.url_name == 'profile' %}active{% endif %}">Profile</a>
      <a href="#">Notifications</a>
    </nav>
    <div class="search-profile">
      <input type="text" class="top-search" placeholder="Search opportunities...">

      <!-- PROFILE DROPDOWN -->
      <div class="profile-dropdown">
    <img src="{% if user.profile.profile_picture %}
                {{ user.profile.profile_picture.url }}
            {% else %}
                /static/Myapp/default-avatar.png
            {% endif %}"
         alt="Profile"
         class="avatar"
         id="profileAvatar">

        <div class="dropdown-menu" id="profileMenu">
          <div class="dropdown-header">Student</div>
          <a href="{% url 'profile' %}"><i class="fa-solid fa-user"></i> Profile</a>
          <a href="#"><i class="fa-solid fa-gear"></i> Settings</a>
          <a href="{% url 'logout' %}"><i class="fa-solid fa-right-from-bracket"></i> Log out</a>
        </div>
      </div>
    </div>
  </header>




 <!-- Profile Section -->
<main class="profile-main">
    <button id="editBtn" class="edit-profile-btn"><i class="fa-solid fa-pen-to-square"></i> Edit Profile</button>
    <button id="saveBtn" class="edit-profile-btn" style="display:none; background: #34d399;">Save Changes</button>

    <div class="profile-layout">
        <!-- Sidebar -->
        <aside class="profile-side">
            <div class="profile-card">

                <img src="{% if user.profile.profile_picture %}
              {{ user.profile.profile_picture.url }}
          {% else %}
              /static/Myapp/default-avatar.png
          {% endif %}"
     alt="Student Avatar"
     class="profile-photo">



                <div class="profile-major-year" id="majorYearView">
    {{ profile.major }} ‚Ä¢ {{ profile.academic_year }}
</div>


                <div class="profile-info-list" id="infoListView">
    <div><i class="fa-regular fa-envelope"></i> 
        <span id="emailView">{{ profile.user.email }}</span>
    </div>

    <div><i class="fa-solid fa-phone"></i> 
        <span id="phoneView">{{ profile.phone }}</span>
    </div>

    <div><i class="fa-solid fa-graduation-cap"></i> 
        <span id="majorView">{{ profile.major }}</span>
    </div>

    <div><i class="fa-regular fa-calendar"></i> 
        <span id="yearView">{{ profile.academic_year }}</span>
    </div>
</div>


                <hr>

                <div class="profile-links" id="portfolioLinksView">
                    <strong>Portfolio Links</strong><br>
                    <div id="linksListView"></div>
                </div>

                <hr>

                <div class="profile-resume">
                    <strong>Resume</strong>

                    <button class="resume-btn" id="resumeBtnView">
                        <i class="fa-regular fa-file"></i> Upload Resume
                    </button>

                    <!-- ‚úî Upload box INSIDE the card -->
                    <div id="resumeUploadBox" class="upload-card" style="display:none; margin-top:15px;">
                        <div class="upload-icon">üìÅ</div>

                        <p class="upload-text">
                            Drag your documents here to start uploading.
                        </p>

                        <div class="upload-or">OR</div>

                        <button class="upload-btn" id="resumeBrowseBtn">Browse files</button>

                        <p style="margin-top:10px; font-size:0.9rem; color:#555;">
                            File size must be under 500KB <br>
                            Please upload PDF, DOC, or DOCX files only
                        </p>

                        <input type="file" id="resumeFileInput" hidden>
                    </div>

                </div><!-- end profile-resume -->

            </div><!-- end profile-card -->
        </aside><!-- end profile-side -->



      <!-- Form Section -->
      <section class="profile-form-section">
<form class="profile-form" method="POST" action="{% url 'update_profile' %}" enctype="multipart/form-data">
  
  {% csrf_token %}
  <fieldset>
    <legend><strong><i class="fa-regular fa-address-card"></i> Personal Information</strong></legend>

   <div class="profile-form-group" id="profilePictureWrapper" style="display: none;">
    <label for="profile_picture">Profile Picture</label>
    <input type="file" name="profile_picture" id="profile_picture" accept="image/*" disabled>
</div>



    <div class="profile-form-row">
      <div class="profile-form-group">
        <label for="fullName">Full Name</label>
        <input type="text" id="fullName" name="full_name" value="{{ profile.full_name }}" disabled>
      </div>

      <div class="profile-form-group">
        <label for="email">Email</label>
        <input type="email" id="email" name="email" value="{{ profile.user.email }}" disabled>
      </div>
    </div>

    <div class="profile-form-row">
      <div class="profile-form-group">
        <label for="phone">Phone</label>
        <input type="tel" id="phone" name="phone" value="{{ profile.phone }}" disabled>
      </div>

      <div class="profile-form-group">
        <label for="year">Academic Year</label>
        <input type="text" id="year" name="academic_year" value="{{ profile.academic_year }}" disabled>
      </div>
    </div>

    <div class="profile-form-row">
      <div class="profile-form-group">
        <label for="major">Course/Major</label>
        <input type="text" id="major" name="major" value="{{ profile.major }}" disabled>
      </div>
    </div>

    <div class="profile-form-row">
      <div class="profile-form-group" style="flex:2;">
        <label for="bio">Bio</label>
        <textarea id="bio" name="bio" rows="3" disabled>{{ profile.bio }}</textarea>
      </div>
    </div>

  </fieldset>
</form>

        <!-- Skills -->
        <div class="profile-skills">
          <fieldset>
            <legend><strong><i class="fa-solid fa-lightbulb"></i> Skills</strong></legend>
            <div class="skills-desc">Add skills that showcase your expertise to potential organizations.</div>
            <div class="skills-list" id="skillsList"></div>
            <div id="skillInputWrap" style="display:none; margin-top:10px;">
              <input type="text" id="newSkill" placeholder="Add a skill..." />
              <button type="button" id="addSkillBtn">+</button>
            </div>
          </fieldset>
        </div>
        <!-- Portfolio Links: Redesigned Block -->
        <div id="portfolioLinkEditBlock" style="display:none;">
          <fieldset class="portfolio-fieldset">
            <legend>
              <strong><i class="fa-solid fa-link"></i> Add Portfolio Link</strong>
            </legend>
            <div class="portfolio-form-row">
              <input type="text" id="portfolioName" class="portfolio-input" placeholder="Link name (e.g. GitHub)" />
              <input type="url" id="portfolioURL" class="portfolio-input" placeholder="URL" />
              <button type="button" id="addLinkBtn" class="portfolio-add-btn">Add Link</button>
            </div>
            <div id="portfolioLinksEdit" style="margin-top:16px;"></div>
          </fieldset>
        </div>
      </section>
    </div>

    
  </main>
  <!-- ‚úÖ Scripts -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
    // Edit / Save Profile
    const editBtn = document.getElementById("editBtn");
    const saveBtn = document.getElementById("saveBtn");
    const inputs = document.querySelectorAll(".profile-form input, .profile-form textarea");
    const skillInputWrap = document.getElementById("skillInputWrap");
    const portfolioBlock = document.getElementById("portfolioLinkEditBlock");

   editBtn.addEventListener('click', () => {
    // Enable all text inputs + textarea
    inputs.forEach(i => i.disabled = false);

    // Enable profile picture input
    document.getElementById("profile_picture").disabled = false;

    // Show the hidden profile picture upload field
    document.getElementById("profilePictureWrapper").style.display = "block";

    // Toggle buttons
    editBtn.style.display = "none";
    saveBtn.style.display = "inline-block";

    // Enable skills + portfolio
    skillInputWrap.style.display = "flex";
    portfolioBlock.style.display = "block";
});



    // Skills
    const skillsList = document.getElementById("skillsList");
    const addSkillBtn = document.getElementById("addSkillBtn");
    const newSkill = document.getElementById("newSkill");
    addSkillBtn.addEventListener("click", () => {
      const skill = newSkill.value.trim();
      if (skill) {
        const skillDiv = document.createElement("div");
        skillDiv.classList.add("skill-item");
        skillDiv.textContent = skill;
        const removeBtn = document.createElement("span");
        removeBtn.textContent = "√ó";
        removeBtn.classList.add("remove-skill");
        removeBtn.onclick = () => skillDiv.remove();
        skillDiv.appendChild(removeBtn);
        skillsList.appendChild(skillDiv);
        newSkill.value = "";
      }
    });
    // Portfolio Links
    const addLinkBtn = document.getElementById("addLinkBtn");
    const portfolioName = document.getElementById("portfolioName");
    const portfolioURL = document.getElementById("portfolioURL");
    const linksListView = document.getElementById("linksListView");
    const portfolioLinksEdit = document.getElementById("portfolioLinksEdit");

    // Create link without delete button for view mode
    const createViewLink = (name, url) => {
      const linkEl = document.createElement("div");
      linkEl.classList.add("portfolio-link");
      linkEl.innerHTML = `<a href="${url}" target="_blank">${name}</a>`;
      return linkEl;
    };

    // Create link with delete button for edit mode
    const createEditLink = (name, url) => {
      const linkEl = document.createElement("div");
      linkEl.classList.add("portfolio-link");
      linkEl.innerHTML = `
        <a href="${url}" target="_blank">${name}</a>
        <button type="button" class="remove-link" style="margin-left: 8px; color: #dc2626; background: none; border: none; cursor: pointer; font-weight: bold;">√ó</button>
      `;
      linkEl.querySelector(".remove-link").addEventListener("click", () => {
        linkEl.remove();
      });
      return linkEl;
    };

    addLinkBtn.addEventListener("click", () => {
      const name = portfolioName.value.trim();
      const url = portfolioURL.value.trim();
      if (name && url) {
        // Add link without delete button to view section
        const viewLink = createViewLink(name, url);
        linksListView.appendChild(viewLink);

        // Add link with delete button to edit section
        const editLink = createEditLink(name, url);
        portfolioLinksEdit.appendChild(editLink);

        // Clear inputs
        portfolioName.value = "";
        portfolioURL.value = "";
      }
    })
  
document.getElementById("resumeBtnView").addEventListener("click", function () {
    const box = document.getElementById("resumeUploadBox");

    // toggle
    if (box.style.display === "none" || box.style.display === "") {
        box.style.display = "block";   // show
    } else {
        box.style.display = "none";    // hide
    }
});

saveBtn.addEventListener("click", () => {
    document.querySelector(".profile-form").submit();
});

        // Profile dropdown
        const avatar = document.getElementById('profileAvatar');
        const menu = document.getElementById('profileMenu');
        if (avatar && menu) {
            avatar.addEventListener('click', () => { 
                menu.parentElement.classList.toggle('show'); 
            });
            
            window.addEventListener('click', (e) => {
                if (!avatar.contains(e.target) && !menu.contains(e.target)) { 
                    menu.parentElement.classList.remove('show'); 
                }
            });
        }
    });

  </script>
</body>
</html>
