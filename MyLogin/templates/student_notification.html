{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CampusLink â€“ Notifications</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Same CSS stack as the student dashboard -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="{% static 'Myapp/student_dashboard.css' %}?v=3.5">
  <link rel="stylesheet" href="{% static 'Myapp/main.css' %}">
  <link rel="stylesheet" href="{% static 'Myapp/error_message.css' %}">

  <!-- Pageâ€“specific styles for the notification list/card -->
  <link rel="stylesheet" href="{% static 'Myapp/student_notification.css' %}?v=1.0">
</head>
<body>

  <!-- HEADER: copied from org_dashboard, bell is a direct link -->
    <!-- HEADER: same as student dashboard -->
  <header class="sticky top-0 z-40 bg-white">
    <!-- full-width header background; inner container centers content -->
    <div class="w-full left-0 right-0 shadow-[0_4px_12px_rgba(0,0,0,0.08)]">
        <div class="max-w-[1400px] mx-auto w-full flex items-center justify-between px-12 py-4 rounded-b-[16px] ">

            <div class="logo flex items-center gap-3 text-[#00c6ff]">
                <i class="fa-solid fa-graduation-cap text-2xl"></i>
                <span class="text-2xl font-extrabold">CampusLink</span>
            </div>

            <nav class="flex items-center">
                <a href="{% url 'student_dashboard' %}" class="text-gray-600 font-medium text-base pb-1 border-b-2 border-transparent hover:text-[#00c6ff] hover:border-[#00c6ff] ">Home</a>
                <a href="{% url 'my_applications' %}" class="text-gray-600 font-medium text-base pb-1 border-b-2 border-transparent hover:text-[#00c6ff] hover:border-[#00c6ff]">My Applications</a>
                <a href="{% url 'profile' %}" class="font-medium text-base pb-1 border-b-2 border-transparent">Profile</a>
            </nav>

            <div class="search-profile flex items-center gap-4">

                <!-- ðŸ”” NOTIFICATION BELL -->
                <div class="notification-wrapper relative">
                    <a href="{% url 'student_notification' %}" id="notifBell" class="notif-bell text-gray-600 hover:text-[#00c6ff] relative">
                        <i class="fa-solid fa-bell"></i>
                        {% if unread_count > 0 %}
                        <span class="notif-badge">{{ unread_count }}</span>
                        {% endif %}
                    </a>
                </div>

                <!-- PROFILE DROPDOWN -->
                <div class="profile-dropdown">
                    <img src="{% if user.profile.profile_picture %}{{ user.profile.profile_picture.url }}{% else %}{% static 'Myapp/default-avatar.png' %}{% endif %}"
                             alt="Profile"
                             class="avatar"
                             id="profileAvatar">

                    <div class="dropdown-menu" id="profileMenu">
                        <div class="dropdown-header">Student</div>

                        <a href="{% url 'profile' %}">
                            <i class="fa-solid fa-user"></i> Profile
                        </a>

                        <a href="{% url 'logout' %}">
                            <i class="fa-solid fa-right-from-bracket"></i> Log out
                        </a>
                    </div>
                </div>

            </div>

        </div>
    </div>
</header>


  <!-- MAIN CONTENT -->
  <main class="notif-page">
    <div class="notifications-container">
      
      <!-- Main notification card -->
      <section class="notif-card">
        <!-- Card header -->
        <div class="notif-card-header">
          <div>
            <h1 class="notif-title">List Notification</h1>
            <p class="notif-count-line">
              {{ notifications.count }} Notification{% if notifications.count != 1 %}s{% endif %}
            </p>
          </div>
          <button class="notif-icon-btn" type="button">
            <i class="fa-solid fa-ellipsis-vertical"></i>
          </button>
        </div>

        <!-- Tabs + search -->
        <div class="notif-toolbar">
          <div class="notif-tabs">
            <!-- Tabs now use links with ?tab= -->
            <a href="{% url 'notifications' %}?tab=all"
               class="notif-tab {% if active_tab == 'all' %}notif-tab-active{% endif %}">
              <span>All</span>
              <span class="notif-tab-pill">{{ notifications.count }}</span>
            </a>

          

            <a href="{% url 'notifications' %}?tab=favorite"
     class="notif-tab {% if active_tab == 'favorite' %}notif-tab-active{% endif %}">
    <span>Favorite</span>
    <span class="notif-tab-pill">{{ favorite_count }}</span>
  </a>

          </div>

          <div class="notif-actions">
            <!-- REAL "Mark all as read" POST form -->
          

            <div class="notif-search">
              <i class="fa-solid fa-magnifying-glass"></i>
              <input type="text" placeholder="Search notifications..." id="notifSearchInput" />
            </div>
          </div>
        </div>

        <!-- Notification list -->
        {% if notifications %}
          <ul class="notification-list" id="notificationList">
            {% for notification in notifications %}
              <li id="notification-{{ notification.id }}"
                  class="notification-item {% if not notification.read %}unread{% endif %}">
                <!-- Left icons -->
                <div class="notification-left">
                  <span class="notif-status-dot {% if not notification.read %}unread-dot{% endif %}"></span>

                  <!-- Favorite toggle form -->
                  <form method="post"
      action="{% url 'notification_toggle_favorite' notification.id %}">
  {% csrf_token %}
  <button
    class="notif-icon-btn star-btn {% if notification.is_favorite %}star-btn-active{% endif %}"
    type="submit"
    title="Toggle favorite"
  >
    {% if notification.is_favorite %}
      <i class="fa-solid fa-star"></i>
    {% else %}
      <i class="fa-regular fa-star"></i>
    {% endif %}
  </button>
</form>

                </div>

                <!-- Main content -->
                <div class="notification-body">
                  <div class="notification-title-line">
  <span class="notification-title-text">
    {{ notification.title }}
  </span>

  {# Type badge #}
  {% if notification.notification_type %}
    {% if notification.notification_type == 'posting_approved' %}
      <span class="notif-type-badge notif-type-approve">Approved</span>
    {% elif notification.notification_type == 'posting_rejected' %}
      <span class="notif-type-badge notif-type-reject">Rejected</span>
    {% elif notification.notification_type == 'verification_approved' %}
      <span class="notif-type-badge notif-type-approve">Verified</span>
    {% elif notification.notification_type == 'verification_rejected' %}
      <span class="notif-type-badge notif-type-reject">Verification Rejected</span>
    {% else %}
      {# default badge, if ever used #}
      <span class="notif-type-badge notif-type-verify">Update</span>
    {% endif %}
  {% endif %}
</div>

                  <div class="notification-message">
                    {{ notification.message }}
                  </div>
                </div>

                <!-- Right side -->
                <div class="notification-right">
                  <span class="notification-time-ago">
                    {{ notification.timestamp|timesince }} ago
                  </span>

                  <!-- Archive button -->
                

                  <!-- Delete button -->
                  <form method="post"
                        action="{% url 'notification_delete' notification.id %}"
                        style="display:inline-block;">
                    {% csrf_token %}
                    <button class="notif-icon-btn delete-btn" type="submit" title="Delete">
                      <i class="fa-regular fa-trash-can"></i>
                    </button>
                  </form>
                </div>
              </li>
            {% endfor %}
          </ul>
        {% else %}
          <div class="empty-state">
            <i class="far fa-bell"></i>
            <h3>No Notifications Yet</h3>
            <p>You don't have any notifications at the moment. We'll notify you when there are updates.</p>
          </div>
        {% endif %}
      </section>
    </div>
  </main>

  <script>
    // Highlight and scroll to a specific notification if opened with #notification-ID
    document.addEventListener("DOMContentLoaded", function() {
      const hash = window.location.hash;
      if (hash && hash.startsWith("#notification-")) {
        const target = document.querySelector(hash);
        if (target) {
          target.classList.add("focused");
          target.scrollIntoView({ behavior: "smooth", block: "center" });
        }
      }
    });

    // Very basic front-end search filter
    document.addEventListener("DOMContentLoaded", function () {
      const searchInput = document.getElementById("notifSearchInput");
      const notifList = document.getElementById("notificationList");
      if (searchInput && notifList) {
        searchInput.addEventListener("input", function () {
          const term = this.value.toLowerCase();
          document.querySelectorAll("#notificationList .notification-item").forEach(item => {
            const text = item.textContent.toLowerCase();
            item.style.display = text.includes(term) ? "" : "none";
          });
        });
      }

      // Profile dropdown toggle (same as org dashboard)
      const profileAvatar = document.getElementById("profileAvatar");
      const orgDropdownMenu = document.getElementById("orgDropdownMenu");

      if (profileAvatar && orgDropdownMenu) {
        profileAvatar.addEventListener("click", function (event) {
          event.stopPropagation();
          const isVisible = orgDropdownMenu.style.display === "flex";
          orgDropdownMenu.style.display = isVisible ? "none" : "flex";
        });

        document.addEventListener("click", function (event) {
          if (!event.target.closest(".profile-dropdown")) {
            orgDropdownMenu.style.display = "none";
          }
        });
      }
    });
  </script>
</body>
</html>
