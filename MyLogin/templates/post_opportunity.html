{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Create Opportunity â€“ CampusLink</title>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- Use the SAME header + global org dashboard styles -->
   
  <link rel="stylesheet" href="{% static 'Myapp/org_dashboard.css' %}">
  <link rel="stylesheet" href="{% static 'Myapp/post_opportunity.css' %}?v=1.0">
  <!-- Include the error message component CSS -->
  <link rel="stylesheet" href="{% static 'Myapp/error_message.css' %}">

  <!-- ðŸ‘‰ Select2 styles + jQuery + Select2 JS -->
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
</head>


<body>

<!-- Alert container for global error messages -->
<div class="alert-container"></div>

<!-- ============================
     NEW HEADER (Identical to org_dashboard)
============================ -->
<header class="header">
    <div class="logo">
      <i class="fa-solid fa-graduation-cap"></i>
      <span>CampusLink</span>
    </div>

    <nav>
      <a href="{% url 'organization_dashboard' %}">Dashboard</a>
      <a href="{% url 'post_opportunity' %}" class="active">Post Opportunity</a>
      <a href="{% url 'manage_postings' %}">Applicants</a>
      <a href="{% url 'org_profile' %}">Profile</a>

    </nav>

    <div class="search-profile">
      <!-- ðŸ”” NOTIFICATION BELL (CLEAN VERSION) -->
<div class="notification-wrapper">
    <a href="{% url 'notifications' %}" id="notifBell" class="notif-bell">
        <i class="fa-solid fa-bell"></i>
        {% if unread_count > 0 %}
            <span class="notif-badge">{{ unread_count }}</span>
        {% endif %}
    </a>
</div>

      <!-- PROFILE DROPDOWN -->
      <div class="profile-dropdown">
          <img src="{% if user.profile.profile_picture %}
                        {{ user.profile.profile_picture.url }}
                    {% else %}
                        /static/Myapp/default-avatar.png
                    {% endif %}"
               alt="Profile"
               class="avatar"
               id="profileAvatar">

          <div class="dropdown-menu" id="orgDropdownMenu">
              <div class="dropdown-header">Organization</div>
              <a href="{% url 'org_profile' %}"><i class="fa-solid fa-user"></i> Profile</a>
              <a href="{% url 'manage_postings' %}"><i class="fa-solid fa-users"></i> Applicants</a>
              <a href="{% url 'logout' %}"><i class="fa-solid fa-right-from-bracket"></i> Log out</a>
          </div>
      </div>
    </div>
</header>


<!-- ============================
     MAIN CONTENT (form)
============================ -->
<main>

  <div class="form-container">
    <h2><i class="fa-solid fa-pen-to-square"></i> Create New Opportunity</h2>

    {% if messages %}
      {% for message in messages %}
        <div class="feedback {% if message.tags == 'success' %}success{% else %}error{% endif %}">
          {{ message }} 
        </div>
      {% endfor %}
    {% endif %}
    
    {% if not user.profile.is_verified_organization %}
      <div class="feedback error">
        <strong>Verification Required:</strong> Only verified organizations can post opportunities. 
        <a href="{% url 'submit_verification' %}" style="color: #fff; text-decoration: underline;">Click here to verify your organization</a>.
      </div>
    {% else %}
    <form method="POST">
  {% csrf_token %}

  <!-- Title -->
  <div class="form-group">
    <label for="title">Opportunity Title</label>
    <input type="text" id="title" name="title" required>
  </div>

  <!-- Description -->
  <div class="form-group">
    <label for="description">Description</label>
    <textarea id="description" name="description" rows="5" required></textarea>
  </div>

  <!-- Opportunity Type -->
  <div class="form-group">
    <label for="opportunity_type">Opportunity Type</label>
    <select id="opportunity_type" name="opportunity_type" required>
      <option value="assistantship">Assistantship</option>
      <option value="volunteer">Volunteer</option>
      <option value="internship">Internship</option>
      <option value="job">Job</option>
      <option value="scholarship">Scholarship</option>
      <option value="events">Events</option>
      <option value="sports">Sports</option>
      <option value="leadership">Leadership</option>
      <option value="other">Other</option>
    </select>
  </div>

  <!-- Deadline -->
  <div class="form-group">
    <label for="deadline">Application Deadline</label>
    <input type="date" id="deadline" name="deadline" required>
  </div>

  <!-- â­ TAGS DROPDOWN -->
  <!-- â­ TAGS DROPDOWN (Select2) -->
<div class="form-group">
  <label for="tags">Tags</label>
  <select id="tags" name="tags" multiple>
    <option value="Communication">Communication</option>
    <option value="Outreach">Outreach</option>
    <option value="Events">Events</option>
    <option value="Leadership">Leadership</option>
    <option value="Marketing">Marketing</option>
    <option value="Creative">Creative</option>
    <option value="Technical">Technical</option>
  </select>
</div>

  <button type="submit" class="submit-btn">
    <i class="fa-solid fa-circle-check"></i> Submit Posting
  </button>
</form>
  {% endif %}

  </div>

</main>

<!-- ============================
     DROPDOWN + MODAL SCRIPTS
============================ -->
<script>
/* ============================
   PROFILE DROPDOWN
============================ */
document.getElementById("profileAvatar").addEventListener("click", function () {
    const menu = document.getElementById("orgDropdownMenu");
    menu.style.display = menu.style.display === "flex" ? "none" : "flex";
});

document.addEventListener("click", function (event) {
    if (!event.target.closest(".profile-dropdown")) {
        const menu = document.getElementById("orgDropdownMenu");
        if (menu) menu.style.display = "none";
    }
});
</script>

<script>
/* ============================
   SELECT2 TAGS DROPDOWN
============================ */
$(document).ready(function() {
    $('#tags').select2({
        placeholder: "Select one or more tags",
        allowClear: true,
        width: '100%'
    });
});

/* ============================
   NOTIFICATION (NO DROPDOWN)
   Click bell â†’ go directly to notifications
============================ */
const notifBell = document.getElementById("notifBell");

notifBell.addEventListener("click", function () {
    window.location.href = "{% url 'notifications' %}";
});
</script>

  <!-- Include the error message component JavaScript -->
  <script src="{% static 'Myapp/error_message.js' %}"></script>

</body>
</html>
