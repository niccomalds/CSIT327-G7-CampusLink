{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>CampusLink Dashboard</title>
<link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
  integrity="sha512-K2HkD9yW0d1aEJ6j9fsqWmfgq5s6BvPZ6wFxjVBeYmB3N3O+InqLB1Ho5gJf1sZQukzPlYt9KfaD9fNkQ0Vd8Q=="
  crossorigin="anonymous"
  referrerpolicy="no-referrer"
/>
<link rel="stylesheet" href="{% static 'Myapp/org_dashboard.css' %}?v=2">
<link
  href="https://fonts.googleapis.com/css2?family=Inter:wght@500;600&family=Roboto:wght@400;500&display=swap"
  rel="stylesheet"
/>
</head>
<body>

<header>
  <div class="logo">🏫 CampusLink</div>

  <nav>
    <a href="#" class="active">Dashboard</a>
    <a href="{% url 'manage_postings' %}">Manage Postings</a>
    <a href="#">Post Opportunity</a>
    <a href="#">Applicants</a>
    <a href="#">Org Profile</a>
  </nav>

  <div class="nav-right">
    <input type="text" placeholder="Search opportunities..." />
    <button title="Notifications">🔔</button>
    <div class="profile-dropdown">
      <img src="profile.jpg" alt="Profile" class="avatar" id="profileAvatar">
      <div class="dropdown-menu" id="profileMenu">
        <div class="dropdown-header">Organization</div>
        <a href="#"><i class="fa-solid fa-gear"></i> Settings</a>
        <a href="{% url 'logout' %}"><i class="fa-solid fa-right-from-bracket"></i> Log out</a>
      </div>
    </div>
  </div>
</header>

<main>
  <section class="content">
    <div class="dashboard-title">
      <h1>Organization <span>Dashboard</span></h1>
      <p>Manage your opportunities and connect with talented students.</p>
    </div>

    <div class="stats-grid">
      <div class="card">
        <h4>Active Postings</h4>
        <p class="stat blue">{{ active_postings_count }}</p>
        <small>Currently active opportunities</small>
      </div>
      <div class="card">
        <h4>Total Applicants</h4>
        <p class="stat orange">{{ total_applicants }}</p>
        <small>Total applications received</small>
      </div>
      <div class="card">
        <h4>Total Views</h4>
        <p class="stat green">{{ total_views }}</p>
        <small>Total posting views</small>
      </div>
      <div class="card">
        <h4>Acceptance Rate</h4>
        <p class="stat">{{ acceptance_rate }}%</p>
        <div class="progress-bar"><div class="fill" style="width:{{ acceptance_rate }}%"></div></div>
      </div>
    </div>

    <div class="quick-actions">
      <h3>Quick Actions</h3>
      <div class="actions-grid">
        <a href="{% url 'manage_postings' %}" class="action">📋 Manage Postings</a>
        <div class="action">➕ Post Opportunity</div>
        <div class="action">👥 Review Applicants</div>
        <div class="action">⭐ Update Profile</div>
      </div>
    </div>

    <div class="recent-section">
      <div class="recent-postings">
        <h3>Recent Postings</h3>

        {% if recent_postings %}
          {% for post in recent_postings %}
            <div class="posting-card">
              <div class="posting-info">
                <span class="title">{{ post.title }}</span>
                <span class="status {% if post.deadline|date:'Y-m-d' >= today %}active{% else %}closed{% endif %}">
                  {% if post.deadline|date:'Y-m-d' >= today %}Active{% else %}Ended{% endif %}
                </span>
              </div>
              <div class="description">
                <p>{{ post.description|truncatewords:20|default:"No description provided" }}</p>
              </div>
              <div class="details">
                <small>Deadline: {{ post.deadline|date:"Y-m-d" }} · Status: {{ post.status }}</small>
              </div>
            </div>
          {% endfor %}
        {% else %}
          <div class="posting-card">
            <div class="posting-info">
              <span class="title">No postings yet</span>
              <span class="status closed">Inactive</span>
            </div>
            <div class="details"><small>Create your first posting to get started</small></div>
          </div>
        {% endif %}

        <a href="{% url 'manage_postings' %}" class="view-all">View All Postings</a>
      </div>

      <div class="activity-summary">
        <h3>Activity Summary</h3>
        <ul>
          <li><span class="dot blue"></span> New application for Software Engineering Intern · 2m ago</li>
          <li><span class="dot orange"></span> Marketing Assistant viewed 15 times · 1h ago</li>
          <li><span class="dot green"></span> Research Volunteer deadline reached · 3h ago</li>
          <li><span class="dot blue"></span> Profile viewed by 8 students · 5h ago</li>
        </ul>
        <button class="view-all">View All Activity</button>
      </div>
    </div>
  </section>
</main>

<script>
  document.querySelectorAll(".action").forEach(btn => {
    btn.addEventListener("click", () => alert(btn.textContent + " clicked!"));
  });

  const profileAvatar = document.getElementById("profileAvatar");
  const profileDropdown = document.querySelector(".profile-dropdown");

  profileAvatar.addEventListener("click", (e) => {
    e.stopPropagation();
    profileDropdown.classList.toggle("show");
  });

  // Close dropdown if clicked outside
  document.addEventListener("click", () => {
    profileDropdown.classList.remove("show");
  });
</script>

</body>
</html>